{"ast":null,"code":"import _objectSpread from\"D:/js/socialsite/SOCIALBOOK/connect/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/js/socialsite/SOCIALBOOK/connect/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/js/socialsite/SOCIALBOOK/connect/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/js/socialsite/SOCIALBOOK/connect/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import\"./post.css\";import MoreVertIcon from'@mui/icons-material/MoreVert';import React,{useState,useEffect}from\"react\";import{format}from\"timeago.js\";import{Link}from\"react-router-dom\";import{useContext}from\"react\";import{AuthContext}from\"../../context/AuthContext\";import Box from'@mui/material/Box';import Modal from'@mui/material/Modal';import Button from'@mui/material/Button';import Cancel from'@mui/icons-material/Cancel';import{axiosInstance}from\"../../config\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var style={position:'relative',top:'50%',left:'50%',transform:'translate(-50%, -50%)',width:400,bgcolor:'background.paper',border:'2px solid #000',boxShadow:24,pt:2,px:4,pb:3};export default function Post(_ref){var post=_ref.post,deletePost=_ref.deletePost,socket=_ref.socket;//console.log(post)\nvar _useState=useState(post.likes.length),_useState2=_slicedToArray(_useState,2),like=_useState2[0],setLike=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isLiked=_useState4[0],setisLiked=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),user=_useState6[0],setUser=_useState6[1];var PF=process.env.REACT_APP_PUBLIC_FOLDER;var _useContext=useContext(AuthContext),currentUser=_useContext.user;useEffect(function(){setisLiked(post.likes.includes(currentUser._id));},[currentUser._id,post.likes]);useEffect(function(){var fetchUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axiosInstance.get(\"/users?userId=\".concat(post.userId));case 2:res=_context.sent;setUser(res.data);case 4:case\"end\":return _context.stop();}}},_callee);}));return function fetchUser(){return _ref2.apply(this,arguments);};}();fetchUser();},[post.userId]);var likeHandler=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(type){var _socket$current;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(type===1){try{axiosInstance.put(\"/posts/\"+post._id+\"/like\",{userId:currentUser._id});}catch(err){}setisLiked(!isLiked);setLike(isLiked?like-1:like+1);}socket===null||socket===void 0?void 0:(_socket$current=socket.current)===null||_socket$current===void 0?void 0:_socket$current.emit(\"sendNotification\",{senderName:currentUser.username,receiverId:post.userId,type:type?type:1});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function likeHandler(_x){return _ref3.apply(this,arguments);};}();function handleDelete(){try{axiosInstance.put(\"/posts/update/\".concat(post._id),{userId:currentUser._id});}catch(err){console.log(err);}deletePost();}var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isOpen=_useState8[0],setIsOpen=_useState8[1];var handleOpen=function handleOpen(){setIsOpen(true);};var handleClose=function handleClose(){setIsOpen(false);};return/*#__PURE__*/_jsx(\"div\",{className:\"post\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"postWrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"postTop\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"postTopLeft\",children:[/*#__PURE__*/_jsx(Link,{to:\"Profile/\".concat(user.username),children:/*#__PURE__*/_jsx(\"img\",{className:\"postProfileImg\",src:user.profilePicture?PF+user.profilePicture:PF+\"search.png\",alt:\"\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"postUserName\",children:user.username}),/*#__PURE__*/_jsx(\"span\",{className:\"postDate\",children:format(post.createdAt)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"postTopRight\",children:[/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsx(Modal,{hideBackdrop:true,open:isOpen,onClose:handleClose,\"aria-labelledby\":\"child-modal-title\",\"aria-describedby\":\"child-modal-description\",children:/*#__PURE__*/_jsxs(Box,{sx:_objectSpread(_objectSpread({},style),{},{width:400}),children:[/*#__PURE__*/_jsx(\"h2\",{id:\"child-modal-title\",children:\"Do you want to delete this post?\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",justifyContent:\"space-around\"},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:function onClick(){return handleDelete();},children:\"Yes\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:handleClose,children:\"No\"})]}),/*#__PURE__*/_jsx(Cancel,{style:{position:\"absolute\",top:\"0%\",right:\"0%\"},onClick:handleClose})]})})}),/*#__PURE__*/_jsx(MoreVertIcon,{onClick:handleOpen,className:\"moreVert\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"postCenter\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"postText\",children:post===null||post===void 0?void 0:post.desc}),/*#__PURE__*/_jsx(\"img\",{className:\"postImg\",src:PF+post.img,alt:\"\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"postBottom\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"postBottomLeft\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"likeIcon\",src:\"\".concat(PF,\"like.png\"),onClick:function onClick(){return likeHandler(\"1\");},alt:\"\"}),/*#__PURE__*/_jsx(\"img\",{className:\"heartIcon\",src:\"\".concat(PF,\"heart.png\"),onClick:function onClick(){return likeHandler(\"2\");},alt:\"\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"likeCounter\",children:[like,\" people liked it\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"postBottomRight\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"postCommentText\",onClick:function onClick(){return likeHandler(\"3\");},children:[post.comment,\" comments\"]})})]})]})});}","map":{"version":3,"names":["MoreVertIcon","React","useState","useEffect","format","Link","useContext","AuthContext","Box","Modal","Button","Cancel","axiosInstance","style","position","top","left","transform","width","bgcolor","border","boxShadow","pt","px","pb","Post","post","deletePost","socket","likes","length","like","setLike","isLiked","setisLiked","user","setUser","PF","process","env","REACT_APP_PUBLIC_FOLDER","currentUser","includes","_id","fetchUser","get","userId","res","data","likeHandler","type","put","err","current","emit","senderName","username","receiverId","handleDelete","console","log","isOpen","setIsOpen","handleOpen","handleClose","profilePicture","createdAt","display","justifyContent","right","desc","img","comment"],"sources":["D:/js/socialsite/SOCIALBOOK/connect/react-social/src/components/post/Post.jsx"],"sourcesContent":["import \"./post.css\"\r\nimport MoreVertIcon from '@mui/icons-material/MoreVert';\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { format } from \"timeago.js\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useContext } from \"react\";\r\nimport { AuthContext } from \"../../context/AuthContext\"\r\nimport Box from '@mui/material/Box';\r\nimport Modal from '@mui/material/Modal';\r\nimport Button from '@mui/material/Button';\r\nimport Cancel from '@mui/icons-material/Cancel'\r\nimport { axiosInstance } from \"../../config\";\r\n\r\n\r\nconst style = {\r\n    position: 'relative',\r\n    top: '50%',\r\n    left: '50%',\r\n    transform: 'translate(-50%, -50%)',\r\n    width: 400,\r\n    bgcolor: 'background.paper',\r\n    border: '2px solid #000',\r\n    boxShadow: 24,\r\n    pt: 2,\r\n    px: 4,\r\n    pb: 3,\r\n};\r\n\r\nexport default function Post({ post, deletePost, socket }) {\r\n\r\n    //console.log(post)\r\n    const [like, setLike] = useState(post.likes.length);\r\n    const [isLiked, setisLiked] = useState(false);\r\n    const [user, setUser] = useState({});\r\n\r\n    const PF = process.env.REACT_APP_PUBLIC_FOLDER;\r\n    const { user: currentUser } = useContext(AuthContext);\r\n\r\n    useEffect(() => {\r\n        setisLiked(post.likes.includes(currentUser._id))\r\n    }, [currentUser._id, post.likes])\r\n\r\n\r\n    useEffect(() => {\r\n        const fetchUser = async () => {\r\n            const res = await axiosInstance.get(`/users?userId=${post.userId}`);\r\n            setUser(res.data);\r\n        }\r\n        fetchUser();\r\n    }, [post.userId])\r\n\r\n\r\n\r\n    const likeHandler = async (type) => {\r\n        if (type === 1) {\r\n            try {\r\n                axiosInstance.put(\"/posts/\" + post._id + \"/like\", { userId: currentUser._id })\r\n            } catch (err) {\r\n\r\n            }\r\n            setisLiked(!isLiked);\r\n            setLike(isLiked ? like - 1 : like + 1);\r\n        }\r\n\r\n        socket?.current?.emit(\"sendNotification\", {\r\n            senderName: currentUser.username,\r\n            receiverId: post.userId,\r\n            type: type ? type : 1,\r\n        })\r\n    };\r\n\r\n\r\n\r\n    function handleDelete() {\r\n        try {\r\n            axiosInstance.put(`/posts/update/${post._id}`, { userId: currentUser._id })\r\n        } catch (err) {\r\n            console.log(err)\r\n        }\r\n        deletePost();\r\n    }\r\n    const [isOpen, setIsOpen] = useState(false);\r\n\r\n    const handleOpen = () => {\r\n        setIsOpen(true);\r\n    }\r\n\r\n    const handleClose = () => {\r\n        setIsOpen(false);\r\n    }\r\n\r\n\r\n    return (\r\n        <div className=\"post\">\r\n            <div className=\"postWrapper\">\r\n                <div className=\"postTop\">\r\n                    <div className=\"postTopLeft\">\r\n                        <Link to={`Profile/${user.username}`}>\r\n                            <img className=\"postProfileImg\" src={user.profilePicture ? PF + user.profilePicture : PF + \"search.png\"} alt=\"\" />\r\n                        </Link>\r\n                        <span className=\"postUserName\">{user.username}</span>\r\n                        <span className=\"postDate\">{format(post.createdAt)}</span>\r\n                    </div>\r\n                    <div className=\"postTopRight\">\r\n\r\n                        <React.Fragment>\r\n                            <Modal\r\n                                hideBackdrop\r\n                                open={isOpen}\r\n                                onClose={handleClose}\r\n                                aria-labelledby=\"child-modal-title\"\r\n                                aria-describedby=\"child-modal-description\"\r\n                            >\r\n                                <Box sx={{ ...style, width: 400 }}>\r\n                                    <h2 id=\"child-modal-title\">Do you want to delete this post?</h2>\r\n                                    <div style={{ display: \"flex\", justifyContent: \"space-around\" }}>\r\n                                        <Button variant=\"outlined\" onClick={() => handleDelete()}>Yes</Button>\r\n                                        <Button variant=\"outlined\" onClick={handleClose}>No</Button>\r\n\r\n                                    </div>\r\n                                    <Cancel style={{ position: \"absolute\", top: \"0%\", right: \"0%\" }} onClick={handleClose} />\r\n                                </Box>\r\n                            </Modal>\r\n                        </React.Fragment>\r\n\r\n                        < MoreVertIcon onClick={handleOpen} className=\"moreVert\" />\r\n\r\n                    </div>\r\n                </div>\r\n                <div className=\"postCenter\">\r\n                    <span className=\"postText\">\r\n                        {post?.desc}\r\n                    </span>\r\n                    <img className=\"postImg\" src={PF + post.img} alt=\"\" />\r\n\r\n                </div>\r\n                <div className=\"postBottom\">\r\n                    <div className=\"postBottomLeft\">\r\n                        <img className=\"likeIcon\" src={`${PF}like.png`} onClick={() => likeHandler(\"1\")} alt=\"\" />\r\n                        <img className=\"heartIcon\" src={`${PF}heart.png`} onClick={() => likeHandler(\"2\")} alt=\"\" />\r\n                        <span className=\"likeCounter\">{like} people liked it</span>\r\n                    </div>\r\n                    <div className=\"postBottomRight\">\r\n                        <span className=\"postCommentText\" onClick={() => likeHandler(\"3\")}>{post.comment} comments</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}