{"ast":null,"code":"import _regeneratorRuntime from\"D:/js/socialsite/SOCIALBOOK/connect/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/js/socialsite/SOCIALBOOK/connect/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/js/socialsite/SOCIALBOOK/connect/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useContext,useEffect,useState}from\"react\";import Post from\"../post/Post\";import Share from\"../share/Share\";import\"./feed.css\";import{AuthContext}from\"../../context/AuthContext\";import{axiosInstance}from\"../../config\";import Status from\"../../components/status/Status\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Feed(_ref){var username=_ref.username,socket=_ref.socket;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),posts=_useState2[0],setPosts=_useState2[1];var _useContext=useContext(AuthContext),user=_useContext.user;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),status=_useState4[0],setStatus=_useState4[1];useEffect(function(){fetchPosts();fetchStatus();},[user]);var fetchPosts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!username){_context.next=7;break;}_context.next=4;return axiosInstance.get(\"/posts/profile/\"+username);case 4:_context.t0=_context.sent;_context.next=10;break;case 7:_context.next=9;return axiosInstance.get(\"/posts/timeline/\"+user._id);case 9:_context.t0=_context.sent;case 10:res=_context.t0;setPosts(res.data.sort(function(p1,p2){return new Date(p2.createdAt)-new Date(p1.createdAt);}));_context.next=16;break;case 14:_context.prev=14;_context.t1=_context[\"catch\"](0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return function fetchPosts(){return _ref2.apply(this,arguments);};}();var fetchStatus=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axiosInstance.get(\"/status/all/\".concat(user._id));case 3:res=_context2.sent;setStatus(res.data);_context2.next=9;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);case 9:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function fetchStatus(){return _ref3.apply(this,arguments);};}();function deletePost(){fetchPosts();}return/*#__PURE__*/_jsx(\"div\",{className:\"feed\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"feedWrapper\",children:[!username&&/*#__PURE__*/_jsxs(\"div\",{className:\"statusProvider\",children:[/*#__PURE__*/_jsx(Status,{create:true,user:user,fetchStatus:fetchStatus}),status===null||status===void 0?void 0:status.map(function(s){return/*#__PURE__*/_jsx(Status,{create:false,user:user,status:s});})]}),(!username||username===user.username)&&/*#__PURE__*/_jsx(Share,{}),posts===null||posts===void 0?void 0:posts.map(function(p){return/*#__PURE__*/_jsx(Post,{post:p,deletePost:deletePost,socket:socket},p._id);})]})});}","map":{"version":3,"names":["useContext","useEffect","useState","Post","Share","AuthContext","axiosInstance","Status","Feed","username","socket","posts","setPosts","user","status","setStatus","fetchPosts","fetchStatus","get","_id","res","data","sort","p1","p2","Date","createdAt","deletePost","map","s","p"],"sources":["D:/js/socialsite/SOCIALBOOK/connect/react-social/src/components/feed/Feed.jsx"],"sourcesContent":["import { useContext, useEffect, useState } from \"react\";\r\nimport Post from \"../post/Post\";\r\nimport Share from \"../share/Share\";\r\nimport \"./feed.css\";\r\nimport { AuthContext } from \"../../context/AuthContext\";\r\nimport { axiosInstance } from \"../../config\";\r\nimport Status from \"../../components/status/Status\";\r\n\r\nexport default function Feed({ username, socket }) {\r\n  const [posts, setPosts] = useState([]);\r\n  const { user } = useContext(AuthContext);\r\n  const [status, setStatus] = useState([]);\r\n\r\n  useEffect(() => {\r\n    fetchPosts();\r\n    fetchStatus();\r\n  }, [user]);\r\n\r\n  const fetchPosts = async () => {\r\n    try {\r\n      const res = username\r\n        ? await axiosInstance.get(\"/posts/profile/\" + username)\r\n        : await axiosInstance.get(\"/posts/timeline/\" + user._id);\r\n      setPosts(\r\n        res.data.sort((p1, p2) => {\r\n          return new Date(p2.createdAt) - new Date(p1.createdAt);\r\n        })\r\n      );\r\n    } catch (err) {}\r\n  };\r\n\r\n  const fetchStatus = async () => {\r\n    try {\r\n      const res = await axiosInstance.get(`/status/all/${user._id}`);\r\n      setStatus(res.data);\r\n    } catch (err) {}\r\n  };\r\n\r\n  function deletePost() {\r\n    fetchPosts();\r\n  }\r\n\r\n  return (\r\n    <div className=\"feed\">\r\n      <div className=\"feedWrapper\">\r\n        {!username && (\r\n          <div className=\"statusProvider\">\r\n            <Status create={true} user={user} fetchStatus={fetchStatus} />\r\n            {status?.map((s) => (\r\n              <Status create={false} user={user} status={s} />\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {(!username || username === user.username) && <Share />}\r\n        {posts?.map((p) => (\r\n          <Post key={p._id} post={p} deletePost={deletePost} socket={socket} />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"kfAAA,OAASA,UAAT,CAAqBC,SAArB,CAAgCC,QAAhC,KAAgD,OAAhD,CACA,MAAOC,KAAP,KAAiB,cAAjB,CACA,MAAOC,MAAP,KAAkB,gBAAlB,CACA,MAAO,YAAP,CACA,OAASC,WAAT,KAA4B,2BAA5B,CACA,OAASC,aAAT,KAA8B,cAA9B,CACA,MAAOC,OAAP,KAAmB,gCAAnB,C,wFAEA,cAAe,SAASC,KAAT,MAAoC,IAApBC,SAAoB,MAApBA,QAAoB,CAAVC,MAAU,MAAVA,MAAU,CACjD,cAA0BR,QAAQ,CAAC,EAAD,CAAlC,wCAAOS,KAAP,eAAcC,QAAd,eACA,gBAAiBZ,UAAU,CAACK,WAAD,CAA3B,CAAQQ,IAAR,aAAQA,IAAR,CACA,eAA4BX,QAAQ,CAAC,EAAD,CAApC,yCAAOY,MAAP,eAAeC,SAAf,eAEAd,SAAS,CAAC,UAAM,CACde,UAAU,GACVC,WAAW,GACZ,CAHQ,CAGN,CAACJ,IAAD,CAHM,CAAT,CAKA,GAAMG,WAAU,2FAAG,+JAEHP,QAFG,+CAGLH,cAAa,CAACY,GAAd,CAAkB,kBAAoBT,QAAtC,CAHK,sFAILH,cAAa,CAACY,GAAd,CAAkB,mBAAqBL,IAAI,CAACM,GAA5C,CAJK,0CAETC,GAFS,aAKfR,QAAQ,CACNQ,GAAG,CAACC,IAAJ,CAASC,IAAT,CAAc,SAACC,EAAD,CAAKC,EAAL,CAAY,CACxB,MAAO,IAAIC,KAAJ,CAASD,EAAE,CAACE,SAAZ,EAAyB,GAAID,KAAJ,CAASF,EAAE,CAACG,SAAZ,CAAhC,CACD,CAFD,CADM,CAAR,CALe,sJAAH,kBAAVV,WAAU,2CAAhB,CAaA,GAAMC,YAAW,2FAAG,wLAEEX,cAAa,CAACY,GAAd,uBAAiCL,IAAI,CAACM,GAAtC,EAFF,QAEVC,GAFU,gBAGhBL,SAAS,CAACK,GAAG,CAACC,IAAL,CAAT,CAHgB,uJAAH,kBAAXJ,YAAW,2CAAjB,CAOA,QAASU,WAAT,EAAsB,CACpBX,UAAU,GACX,CAED,mBACE,YAAK,SAAS,CAAC,MAAf,uBACE,aAAK,SAAS,CAAC,aAAf,WACG,CAACP,QAAD,eACC,aAAK,SAAS,CAAC,gBAAf,wBACE,KAAC,MAAD,EAAQ,MAAM,CAAE,IAAhB,CAAsB,IAAI,CAAEI,IAA5B,CAAkC,WAAW,CAAEI,WAA/C,EADF,CAEGH,MAFH,SAEGA,MAFH,iBAEGA,MAAM,CAAEc,GAAR,CAAY,SAACC,CAAD,qBACX,KAAC,MAAD,EAAQ,MAAM,CAAE,KAAhB,CAAuB,IAAI,CAAEhB,IAA7B,CAAmC,MAAM,CAAEgB,CAA3C,EADW,EAAZ,CAFH,GAFJ,CAUG,CAAC,CAACpB,QAAD,EAAaA,QAAQ,GAAKI,IAAI,CAACJ,QAAhC,gBAA6C,KAAC,KAAD,IAVhD,CAWGE,KAXH,SAWGA,KAXH,iBAWGA,KAAK,CAAEiB,GAAP,CAAW,SAACE,CAAD,qBACV,KAAC,IAAD,EAAkB,IAAI,CAAEA,CAAxB,CAA2B,UAAU,CAAEH,UAAvC,CAAmD,MAAM,CAAEjB,MAA3D,EAAWoB,CAAC,CAACX,GAAb,CADU,EAAX,CAXH,GADF,EADF,CAmBD"},"metadata":{},"sourceType":"module"}