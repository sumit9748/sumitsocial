{"ast":null,"code":"import _regeneratorRuntime from\"D:/js/socialsite/SOCIALBOOK/connect/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/js/socialsite/SOCIALBOOK/connect/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/js/socialsite/SOCIALBOOK/connect/react-social/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from\"react\";import{axiosInstance}from\"../../config\";import\"./chatOnline.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ChatOnline(_ref){var onlineUsers=_ref.onlineUsers,currentId=_ref.currentId,setCurrentChat=_ref.setCurrentChat;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),friends=_useState2[0],setFriends=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),onlineFriends=_useState4[0],setOnlineFriends=_useState4[1];var PF=process.env.REACT_APP_PUBLIC_FOLDER;useEffect(function(){var getFriends=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axiosInstance.get(\"/users/friends/\"+currentId);case 2:res=_context.sent;setFriends(res.data);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getFriends(){return _ref2.apply(this,arguments);};}();getFriends();},[currentId]);useEffect(function(){setOnlineFriends(friends.filter(function(f){return onlineUsers.includes(f._id);}));},[friends,onlineUsers]);console.log(onlineFriends);var handleClick=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(user){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axiosInstance.get(\"/conversations/find/\".concat(currentId,\"/\").concat(user._id));case 3:res=_context2.sent;console.log(res.data);if(!(res.data===null)){_context2.next=11;break;}_context2.next=8;return axiosInstance.post(\"/conversations/\",{senderId:currentId,receiverId:user._id});case 8:setCurrentChat(res.data);_context2.next=12;break;case 11:setCurrentChat(res.data);case 12:_context2.next=17;break;case 14:_context2.prev=14;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 17:case\"end\":return _context2.stop();}}},_callee2,null,[[0,14]]);}));return function handleClick(_x){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"chatOnline\",children:onlineFriends.map(function(o){return/*#__PURE__*/_jsxs(\"div\",{className:\"chatOnlineFriend\",onClick:function onClick(){return handleClick(o);},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chatOnlineImgContainer\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"chatOnlineImg\",src:(o===null||o===void 0?void 0:o.profilePicture)?PF+o.profilePicture:PF+\"person/noAvatar.png\",alt:\"\"}),/*#__PURE__*/_jsx(\"div\",{className:\"chatOnlineBadge\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"chatOnlineName\",children:o===null||o===void 0?void 0:o.username})]});})});}","map":{"version":3,"names":["useEffect","useState","axiosInstance","ChatOnline","onlineUsers","currentId","setCurrentChat","friends","setFriends","onlineFriends","setOnlineFriends","PF","process","env","REACT_APP_PUBLIC_FOLDER","getFriends","get","res","data","filter","f","includes","_id","console","log","handleClick","user","post","senderId","receiverId","map","o","profilePicture","username"],"sources":["D:/js/socialsite/SOCIALBOOK/connect/react-social/src/components/chatOnline/ChatOnline.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { axiosInstance } from \"../../config\";\r\nimport \"./chatOnline.css\";\r\n\r\nexport default function ChatOnline({ onlineUsers, currentId, setCurrentChat }) {\r\n  const [friends, setFriends] = useState([]);\r\n  const [onlineFriends, setOnlineFriends] = useState([]);\r\n  const PF = process.env.REACT_APP_PUBLIC_FOLDER;\r\n\r\n  useEffect(() => {\r\n    const getFriends = async () => {\r\n      const res = await axiosInstance.get(\"/users/friends/\" + currentId);\r\n      setFriends(res.data);\r\n    };\r\n\r\n    getFriends();\r\n  }, [currentId]);\r\n\r\n  useEffect(() => {\r\n    setOnlineFriends(friends.filter((f) => onlineUsers.includes(f._id)));\r\n  }, [friends, onlineUsers]);\r\n\r\n  console.log(onlineFriends);\r\n\r\n  const handleClick = async (user) => {\r\n    try {\r\n      const res = await axiosInstance.get(\r\n        `/conversations/find/${currentId}/${user._id}`\r\n      );\r\n      console.log(res.data);\r\n      if (res.data === null) {\r\n        await axiosInstance.post(\"/conversations/\",\r\n          {\r\n            senderId: currentId,\r\n            receiverId: user._id\r\n          })\r\n        setCurrentChat(res.data);\r\n      } else {\r\n        setCurrentChat(res.data);\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"chatOnline\">\r\n      {onlineFriends.map((o) => (\r\n        <div className=\"chatOnlineFriend\" onClick={() => handleClick(o)}>\r\n          <div className=\"chatOnlineImgContainer\">\r\n            <img\r\n              className=\"chatOnlineImg\"\r\n              src={\r\n                o?.profilePicture\r\n                  ? PF + o.profilePicture\r\n                  : PF + \"person/noAvatar.png\"\r\n              }\r\n              alt=\"\"\r\n            />\r\n            <div className=\"chatOnlineBadge\"></div>\r\n          </div>\r\n          <span className=\"chatOnlineName\">{o?.username}</span>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}"],"mappings":"kfAAA,OAASA,SAAT,CAAoBC,QAApB,KAAoC,OAApC,CACA,OAASC,aAAT,KAA8B,cAA9B,CACA,MAAO,kBAAP,C,wFAEA,cAAe,SAASC,WAAT,MAAgE,IAA1CC,YAA0C,MAA1CA,WAA0C,CAA7BC,SAA6B,MAA7BA,SAA6B,CAAlBC,cAAkB,MAAlBA,cAAkB,CAC7E,cAA8BL,QAAQ,CAAC,EAAD,CAAtC,wCAAOM,OAAP,eAAgBC,UAAhB,eACA,eAA0CP,QAAQ,CAAC,EAAD,CAAlD,yCAAOQ,aAAP,eAAsBC,gBAAtB,eACA,GAAMC,GAAE,CAAGC,OAAO,CAACC,GAAR,CAAYC,uBAAvB,CAEAd,SAAS,CAAC,UAAM,CACd,GAAMe,WAAU,2FAAG,iKACCb,cAAa,CAACc,GAAd,CAAkB,kBAAoBX,SAAtC,CADD,QACXY,GADW,eAEjBT,UAAU,CAACS,GAAG,CAACC,IAAL,CAAV,CAFiB,sDAAH,kBAAVH,WAAU,2CAAhB,CAKAA,UAAU,GACX,CAPQ,CAON,CAACV,SAAD,CAPM,CAAT,CASAL,SAAS,CAAC,UAAM,CACdU,gBAAgB,CAACH,OAAO,CAACY,MAAR,CAAe,SAACC,CAAD,QAAOhB,YAAW,CAACiB,QAAZ,CAAqBD,CAAC,CAACE,GAAvB,CAAP,EAAf,CAAD,CAAhB,CACD,CAFQ,CAEN,CAACf,OAAD,CAAUH,WAAV,CAFM,CAAT,CAIAmB,OAAO,CAACC,GAAR,CAAYf,aAAZ,EAEA,GAAMgB,YAAW,2FAAG,kBAAOC,IAAP,sKAEExB,cAAa,CAACc,GAAd,+BACOX,SADP,aACoBqB,IAAI,CAACJ,GADzB,EAFF,QAEVL,GAFU,gBAKhBM,OAAO,CAACC,GAAR,CAAYP,GAAG,CAACC,IAAhB,EALgB,KAMZD,GAAG,CAACC,IAAJ,GAAa,IAND,mDAORhB,cAAa,CAACyB,IAAd,CAAmB,iBAAnB,CACJ,CACEC,QAAQ,CAAEvB,SADZ,CAEEwB,UAAU,CAAEH,IAAI,CAACJ,GAFnB,CADI,CAPQ,QAYdhB,cAAc,CAACW,GAAG,CAACC,IAAL,CAAd,CAZc,gCAcdZ,cAAc,CAACW,GAAG,CAACC,IAAL,CAAd,CAdc,6FAiBhBK,OAAO,CAACC,GAAR,eAjBgB,uEAAH,kBAAXC,YAAW,6CAAjB,CAqBA,mBACE,YAAK,SAAS,CAAC,YAAf,UACGhB,aAAa,CAACqB,GAAd,CAAkB,SAACC,CAAD,qBACjB,aAAK,SAAS,CAAC,kBAAf,CAAkC,OAAO,CAAE,yBAAMN,YAAW,CAACM,CAAD,CAAjB,EAA3C,wBACE,aAAK,SAAS,CAAC,wBAAf,wBACE,YACE,SAAS,CAAC,eADZ,CAEE,GAAG,CACD,CAAAA,CAAC,OAAD,EAAAA,CAAC,SAAD,QAAAA,CAAC,CAAEC,cAAH,EACIrB,EAAE,CAAGoB,CAAC,CAACC,cADX,CAEIrB,EAAE,CAAG,qBALb,CAOE,GAAG,CAAC,EAPN,EADF,cAUE,YAAK,SAAS,CAAC,iBAAf,EAVF,GADF,cAaE,aAAM,SAAS,CAAC,gBAAhB,UAAkCoB,CAAlC,SAAkCA,CAAlC,iBAAkCA,CAAC,CAAEE,QAArC,EAbF,GADiB,EAAlB,CADH,EADF,CAqBD"},"metadata":{},"sourceType":"module"}